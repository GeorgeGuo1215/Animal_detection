<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECGåŠ¨æ€æ˜¾ç¤ºæµ‹è¯•</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="fft.js"></script>
    <style>
        body {
            background: #1a1a1a;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            padding: 20px;
        }
        .test-section {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .test-title {
            color: #00ccff;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }
        .test-info {
            margin: 10px 0;
            font-size: 0.9rem;
        }
        .success { color: #44ff44; }
        .error { color: #ff4444; }
        .warning { color: #ffaa44; }
        button {
            background: #333;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border-radius: 5px;
        }
        button:hover {
            background: #444;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª ECGåŠ¨æ€æ˜¾ç¤ºæµ‹è¯•é¡µé¢</h1>
    
    <div class="test-section">
        <div class="test-title">ç³»ç»ŸçŠ¶æ€æ£€æŸ¥</div>
        <div id="systemStatus"></div>
        <button onclick="checkSystem()">æ£€æŸ¥ç³»ç»Ÿ</button>
    </div>
    
    <div class="test-section">
        <div class="test-title">ECGç”»å¸ƒæµ‹è¯•</div>
        <div id="canvasStatus"></div>
        <button onclick="testCanvas()">æµ‹è¯•ç”»å¸ƒ</button>
    </div>
    
    <!-- ECGç›‘æµ‹åŒºåŸŸ -->
    <div class="ecg-section">
        <h3>ğŸ«€ åŠ¨æ€ç”Ÿç†ä¿¡å·ç›‘æµ‹æµ‹è¯•</h3>
        <div class="ecg-controls">
            <button class="btn btn-success" id="playBtn" onclick="toggleECGPlayback()">â–¶ï¸ æ’­æ”¾</button>
            <button class="btn btn-secondary" id="pauseBtn" onclick="toggleECGPlayback()" style="display: none;">â¸ï¸ æš‚åœ</button>
            <button class="btn btn-info" onclick="resetECG()">ğŸ”„ é‡ç½®</button>
            <button class="btn btn-warning" onclick="testECG()" style="background: #ffc107; color: #000;">ğŸ§ª ç”Ÿæˆæµ‹è¯•æ•°æ®</button>
        </div>
        
        <div class="ecg-monitors">
            <!-- å‘¼å¸æ³¢å½¢åŠ¨æ€ç›‘æµ‹ -->
            <div class="ecg-monitor respiratory-monitor">
                <div class="monitor-header">
                    <h4>ğŸ« å‘¼å¸æ³¢å½¢</h4>
                    <div class="vital-display">
                        <span class="vital-label">å‘¼å¸é¢‘ç‡:</span>
                        <span class="vital-value" id="currentRespRate">-- bpm</span>
                    </div>
                </div>
                <div class="ecg-screen" id="respiratoryECG">
                    <canvas id="respiratoryECGCanvas"></canvas>
                    <div class="ecg-grid"></div>
                    <div class="ecg-cursor"></div>
                </div>
            </div>
            
            <!-- å¿ƒè·³æ³¢å½¢åŠ¨æ€ç›‘æµ‹ -->
            <div class="ecg-monitor heartbeat-monitor">
                <div class="monitor-header">
                    <h4>ğŸ’“ å¿ƒè·³æ³¢å½¢</h4>
                    <div class="vital-display">
                        <span class="vital-label">å¿ƒç‡:</span>
                        <span class="vital-value" id="currentHeartRate">-- bpm</span>
                    </div>
                </div>
                <div class="ecg-screen" id="heartbeatECG">
                    <canvas id="heartbeatECGCanvas"></canvas>
                    <div class="ecg-grid"></div>
                    <div class="ecg-cursor"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="test-section">
        <div class="test-title">è°ƒè¯•æ—¥å¿—</div>
        <div id="debugLog" style="height: 200px; overflow-y: auto; background: #000; padding: 10px; border: 1px solid #444;"></div>
        <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
    </div>

    <script src="radar-processor.js"></script>
    <script src="app.js"></script>
    
    <script>
        // é‡å†™console.logæ¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
        const originalLog = console.log;
        const originalError = console.error;
        const debugLog = document.getElementById('debugLog');
        
        function addToLog(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = type === 'error' ? 'error' : (type === 'warn' ? 'warning' : 'success');
            logEntry.textContent = `[${timestamp}] ${message}`;
            debugLog.appendChild(logEntry);
            debugLog.scrollTop = debugLog.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToLog(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToLog(args.join(' '), 'error');
        };
        
        function clearLog() {
            debugLog.innerHTML = '';
        }
        
        function checkSystem() {
            const statusDiv = document.getElementById('systemStatus');
            let html = '';
            
            // æ£€æŸ¥å„ç§ç»„ä»¶
            html += `<div class="${typeof FFT !== 'undefined' ? 'success' : 'error'}">FFTåº“: ${typeof FFT !== 'undefined' ? 'âœ“' : 'âœ—'}</div>`;
            html += `<div class="${typeof RadarDataProcessor !== 'undefined' ? 'success' : 'error'}">æ•°æ®å¤„ç†å™¨: ${typeof RadarDataProcessor !== 'undefined' ? 'âœ“' : 'âœ—'}</div>`;
            html += `<div class="${typeof app !== 'undefined' ? 'success' : 'error'}">Appå®ä¾‹: ${typeof app !== 'undefined' ? 'âœ“' : 'âœ—'}</div>`;
            
            if (typeof app !== 'undefined') {
                html += `<div class="${app.ecgAnimations.respiratory ? 'success' : 'error'}">å‘¼å¸ç”»å¸ƒ: ${app.ecgAnimations.respiratory ? 'âœ“' : 'âœ—'}</div>`;
                html += `<div class="${app.ecgAnimations.heartbeat ? 'success' : 'error'}">å¿ƒè·³ç”»å¸ƒ: ${app.ecgAnimations.heartbeat ? 'âœ“' : 'âœ—'}</div>`;
                html += `<div class="test-info">ECGæ•°æ®é•¿åº¦: å‘¼å¸=${app.ecgData.respiratory.length}, å¿ƒè·³=${app.ecgData.heartbeat.length}</div>`;
            }
            
            statusDiv.innerHTML = html;
        }
        
        function testCanvas() {
            const statusDiv = document.getElementById('canvasStatus');
            const respiratoryCanvas = document.getElementById('respiratoryECGCanvas');
            const heartbeatCanvas = document.getElementById('heartbeatECGCanvas');
            
            let html = '';
            html += `<div class="${respiratoryCanvas ? 'success' : 'error'}">å‘¼å¸ç”»å¸ƒå…ƒç´ : ${respiratoryCanvas ? 'âœ“' : 'âœ—'}</div>`;
            html += `<div class="${heartbeatCanvas ? 'success' : 'error'}">å¿ƒè·³ç”»å¸ƒå…ƒç´ : ${heartbeatCanvas ? 'âœ“' : 'âœ—'}</div>`;
            
            if (respiratoryCanvas) {
                const rect = respiratoryCanvas.getBoundingClientRect();
                html += `<div class="test-info">å‘¼å¸ç”»å¸ƒå°ºå¯¸: ${rect.width}x${rect.height}</div>`;
            }
            
            if (heartbeatCanvas) {
                const rect = heartbeatCanvas.getBoundingClientRect();
                html += `<div class="test-info">å¿ƒè·³ç”»å¸ƒå°ºå¯¸: ${rect.width}x${rect.height}</div>`;
            }
            
            statusDiv.innerHTML = html;
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', () => {
            setTimeout(() => {
                checkSystem();
                testCanvas();
                console.log('æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            }, 1000);
        });
    </script>
</body>
</html>

