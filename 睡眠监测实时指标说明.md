# 睡眠监测实时指标说明

## 📊 新增实时指标面板

在睡眠质量监测界面中，新增了一个醒目的实时指标面板，显示4个关键指标的实时变化。

### 1. RMS能量 (Root Mean Square)

**显示内容**：
- 数值：当前RMS值（单位：g）
- 状态标签：根据RMS值自动判断活动状态

**状态分类**：
| RMS范围 | 状态标签 | 含义 |
|---------|---------|------|
| > 0.15g | 剧烈活动 | 宠物正在剧烈运动 |
| 0.05-0.15g | 活动中 | 宠物正在活动 |
| 0.02-0.05g | 轻微活动 | 宠物有轻微体动 |
| < 0.02g | 静息 | 宠物处于静止状态 |

**实时更新**：每1秒更新一次（基于滑动窗口）

### 2. 零交叉率 (MCR - Mean Crossing Rate)

**显示内容**：
- 数值：当前MCR值（单位：次/秒）
- 状态标签：根据MCR值判断体动频率

**状态分类**：
| MCR范围 | 状态标签 | 含义 |
|---------|---------|------|
| > 8次/秒 | 高频 | 频繁快速体动 |
| 5-8次/秒 | 中高频 | 较频繁体动 |
| 2-5次/秒 | 中频 | 中等频率体动 |
| < 2次/秒 | 低频 | 低频率体动或静止 |

**实时更新**：每1秒更新一次

### 3. 阶段持续时间

**显示内容**：
- 数值：当前睡眠阶段已持续的时间（单位：分钟）
- 状态标签：阶段切换提示

**状态显示**：
- "刚切换"：阶段持续时间 < 1分钟
- "持续X分钟"：显示具体持续时间

**用途**：
- 监测睡眠阶段的稳定性
- 识别频繁的阶段切换（可能表示睡眠质量差）
- 验证深睡/浅睡的持续时长是否正常

### 4. 数据更新率

**显示内容**：
- 数值：数据处理频率（单位：Hz）
- 状态标签：最后更新时间

**状态显示**：
- "实时更新中"：最近2秒内有数据更新
- "X秒前"：显示距离上次更新的时间

**用途**：
- 监控数据流是否正常
- 检测蓝牙连接是否稳定
- 验证采样率是否符合预期（应接近1Hz，因为滑动步长为1秒）

## 🎨 视觉设计

实时指标面板采用渐变紫色背景，与其他卡片区分：
- 背景：紫色渐变 (#667eea → #764ba2)
- 文字：白色，高对比度
- 卡片：半透明白色背景
- 布局：4列网格，响应式设计

## 📈 使用场景

### 场景1：验证设备连接
1. 启动睡眠监测
2. 观察"数据更新率"是否显示"实时更新中"
3. 检查更新频率是否接近1Hz

### 场景2：观察睡眠入睡过程
1. 宠物准备睡觉时启动监测
2. 观察RMS从"活动中"逐渐降低到"静息"
3. 观察MCR从"中高频"降低到"低频"
4. 当前状态从"清醒"切换到"浅睡"或"深睡"

### 场景3：检测睡眠中断
1. 宠物睡眠中突然醒来
2. RMS会突然升高到"活动中"
3. MCR会升高到"中高频"或"高频"
4. 阶段持续时间会重置为"刚切换"

### 场景4：分析睡眠质量
1. 观察深睡阶段的RMS是否稳定在低值
2. 检查深睡期间MCR是否保持低频
3. 查看阶段持续时间是否足够长（理想>10分钟）

## 🔍 调试技巧

### 检查RMS计算是否正确
```javascript
// 在浏览器控制台执行
const summary = app.sleepMonitor.getSummary();
console.log('当前RMS:', summary.currentRMS);
console.log('当前MCR:', summary.currentMCR);
```

### 模拟不同活动状态
- **静止测试**：将设备放在桌面上，RMS应 < 0.02g
- **轻微震动**：轻轻敲击桌面，RMS应在0.02-0.05g
- **移动测试**：拿起设备移动，RMS应 > 0.05g

### 验证阶段切换逻辑
```javascript
// 查看最近的睡眠历史
app.sleepMonitor.sleepHistory.slice(-10).forEach(h => {
    console.log(`时间: ${new Date(h.timestamp).toLocaleTimeString()}, 阶段: ${h.stage}, RMS: ${h.rms.toFixed(3)}, MCR: ${h.mcr.toFixed(1)}`);
});
```

## ⚡ 性能优化

- 实时指标每2秒更新一次（与图表更新同步）
- 避免过于频繁的DOM更新
- 使用高效的数值格式化（toFixed）
- 状态标签使用简单的条件判断

## 🎯 预期效果

### 正常睡眠模式
```
时间    RMS      MCR      阶段    持续时间
22:00   0.045g   4.2次/秒  清醒    5分钟
22:05   0.028g   3.1次/秒  浅睡    15分钟
22:20   0.015g   1.5次/秒  深睡    45分钟
23:05   0.032g   4.8次/秒  REM     20分钟
23:25   0.018g   1.8次/秒  深睡    30分钟
```

### 睡眠中断模式
```
时间    RMS      MCR      阶段    持续时间
23:00   0.016g   1.6次/秒  深睡    25分钟
23:25   0.125g   6.5次/秒  清醒    2分钟  ← 突然醒来
23:27   0.035g   3.2次/秒  浅睡    8分钟
23:35   0.019g   1.7次/秒  深睡    继续...
```

## 📱 移动端适配

实时指标面板在移动设备上会自动调整为2×2网格布局，确保在小屏幕上也能清晰显示。

---

**版本**: 1.1.0
**更新时间**: 2026-01-28
**新增功能**: 实时关键指标显示
