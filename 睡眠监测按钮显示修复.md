# 睡眠监测按钮显示修复

## 🐛 问题

用户反馈看不到"开始睡眠监测"按钮。

## 🔍 原因分析

在 `app.js` 的 `updateBLEButtons()` 函数中，只处理了静息监测按钮的显示逻辑，但没有处理活动监测和睡眠监测按钮。

虽然在页面加载时有一个 `MutationObserver` 监听蓝牙断开按钮的变化来显示这些按钮，但这个方法不够可靠。

## ✅ 修复方案

在 `updateBLEButtons()` 函数中添加活动监测和睡眠监测按钮的显示逻辑：

```javascript
// 活动监测按钮
const activityStartBtn = document.getElementById('activityStartBtn');
if (activityStartBtn) {
    activityStartBtn.style.display = this.bleConnected ? 'inline-block' : 'none';
}

// 睡眠监测按钮
const sleepStartBtn = document.getElementById('sleepStartBtn');
if (sleepStartBtn) {
    sleepStartBtn.style.display = this.bleConnected ? 'inline-block' : 'none';
}
```

## 🧪 测试步骤

### 1. 强制刷新浏览器
```
按 Cmd+Shift+R (Mac) 或 Ctrl+Shift+R (Windows)
```

### 2. 打开页面
访问: http://localhost:8000/index.html

### 3. 连接蓝牙
1. 点击"连接蓝牙"按钮
2. 选择设备并连接

### 4. 验证按钮显示
连接成功后，应该能看到以下按钮：
- ✅ **开始活动监测** 按钮（在"活动量与步数监测"部分）
- ✅ **开始睡眠监测** 按钮（在"睡眠质量监测"部分）

### 5. 启动睡眠监测
1. 滚动到"睡眠质量监测"部分
2. 点击"😴 开始睡眠监测"按钮
3. 观察实时指标更新

## 📊 预期效果

### 蓝牙未连接时
- 活动监测按钮：隐藏
- 睡眠监测按钮：隐藏

### 蓝牙连接后
- 活动监测按钮：显示（绿色）
- 睡眠监测按钮：显示（绿色）

### 启动监测后
- 开始按钮：隐藏
- 停止按钮：显示（红色）

## 🔍 调试命令

### 检查按钮元素
```javascript
// 在浏览器控制台执行
const sleepStartBtn = document.getElementById('sleepStartBtn');
console.log('睡眠监测按钮:', sleepStartBtn);
console.log('显示状态:', sleepStartBtn ? sleepStartBtn.style.display : 'null');
```

### 检查蓝牙连接状态
```javascript
console.log('蓝牙连接状态:', app.bleConnected);
```

### 手动显示按钮（调试用）
```javascript
const sleepStartBtn = document.getElementById('sleepStartBtn');
if (sleepStartBtn) {
    sleepStartBtn.style.display = 'inline-block';
    console.log('✅ 已手动显示睡眠监测按钮');
}
```

## 📝 相关文件

- `web/app.js` - 第389-403行（updateBLEButtons函数）
- `web/index.html` - 第301行（sleepStartBtn按钮定义）

## ⚠️ 注意事项

1. **必须先连接蓝牙**才能看到监测按钮
2. **刷新页面后需要重新连接**蓝牙
3. 如果按钮仍然不显示，检查浏览器控制台是否有JavaScript错误

---

**修复版本**: 1.1.2
**修复时间**: 2026-01-28
**修复内容**: 在updateBLEButtons()中添加活动监测和睡眠监测按钮显示逻辑
